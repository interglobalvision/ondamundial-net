{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","$","window","resize","onResize","document","ready","Player","Earth","Programacion","StreamChecker","fixWidows","each","string","html","replace","triggerEvent","eventName","detail","console","log","customEvent","CustomEvent","dispatchEvent","eventsPosts","JSON","parse","WP","programacionEvents","scheduleArray","programacionContainer","getElementById","fillEventsObject","addEventsToDom","forEach","scheduleEvent","eventMoment","moment","unix","parseInt","timestamp","year","format","month","monthNum","day","dayNum","hour","undefined","months","days","events","push","title","content","scheduleHTML","yearIndex","yearContent","createElement","innerText","makeEventsRow","monthIndex","monthContent","dayIndex","dayContent","eventObj","eventIndex","eventContent","className","innerHTML","container","id","rowContent","newRow","appendChild","canvasWidth","canvasHeight","textureUrl","themeUrl","initialCameraZ","animate","bind","camera","THREE","PerspectiveCamera","innerWidth","innerHeight","position","z","scene","Scene","group","Group","add","loadTexture","canvas","width","height","renderCanvas","texture","CanvasTexture","geometry","PlaneBufferGeometry","material","MeshBasicMaterial","map","overdraw","mesh","Mesh","y","rotation","x","Math","PI","renderer","CanvasRenderer","setClearColor","setPixelRatio","devicePixelRatio","setSize","body","clientWidth","domElement","TextureLoader","load","SphereGeometry","requestAnimationFrame","renderScene","lookAt","render","statusUrl","statusCheckInterval","streamData","startChecker","checkStreamStatus","setInterval","getJSON","data","status","fail","neverPlayed","fadeTime","streamUrl","volumeIncrement","playerContainer","playerElement","playerSrc","playButton","pauseButton","streamStatusText","nowPlayingText","handleOnlineStream","handleCanplay","handleOfflineStream","animateTest","addEventListener","play","pause","setupAudioProcessing","audioContext","AudioContext","webkitAudioContext","audioSource","createMediaElementSource","audioAnalyser","createAnalyser","fftSize","minDecibels","maxDecibels","smoothingTimeConstant","analyserData","Uint8Array","frequencyBinCount","connect","destination","event","classList","src","crossOrigin","current_track","level","getAnalyserValue","levelString","Array","join","getByteTimeDomainData","remove","networkState","volume","paused","fadeInterval","newVolume","clearInterval"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Site, Modernizr, moment, WP */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    $(window).resize(function() {\n      _this.onResize();\n    });\n\n    $(document).ready(function () {\n      Site.Player.init();\n      Site.Earth.init();\n      Site.Programacion.init();\n    });\n\n    Site.StreamChecker.init();\n  },\n\n  onResize: function() {\n    var _this = this;\n\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function() {\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n\n  triggerEvent: function(eventName, detail) {\n    var _this =  this;\n\n    console.log('event triggered: ', eventName);\n\n    var customEvent = new CustomEvent(eventName, {\n      detail: detail,\n    });\n\n    document.dispatchEvent(customEvent);\n  },\n};\n\nSite.Programacion = {\n  // parse JSON event posts object from Wordpress\n  eventsPosts: JSON.parse(WP.programacionEvents),\n  scheduleArray: [],\n  init: function() {\n    var _this = this;\n\n    // Set programacion container\n    _this.programacionContainer =  document.getElementById('page-programacion'),\n\n    // Loop through Years -> Months -> Days -> Events\n    _this.fillEventsObject();\n\n    // Add schedule to DOM\n    _this.addEventsToDom();\n  },\n\n  fillEventsObject: function() {\n    var _this = this;\n\n    // Iterate thru each event\n    _this.eventsPosts.forEach(function(scheduleEvent) {\n      // Generate moment from timestamp in user local timezone\n      var eventMoment = moment.unix(parseInt(scheduleEvent.timestamp));\n\n      // Parse date/time data\n      var year = eventMoment.format('YYYY');\n      var month = eventMoment.format('MMMM');\n      var monthNum = eventMoment.format('M');\n      var day = eventMoment.format('dddd Do');\n      var dayNum = eventMoment.format('D');\n      var hour = eventMoment.format('H:mm');\n\n      // Create this Year object if missing in schedule array\n      if (_this.scheduleArray[year] === undefined) {\n        _this.scheduleArray[year] = {\n          year: year,\n          months: []\n        };\n      }\n\n      // Create this Month object if missing in Year\n      if (_this.scheduleArray[year].months[monthNum] === undefined) {\n        _this.scheduleArray[year].months[monthNum] = {\n          month: month,\n          days: []\n        };\n      }\n\n      // Create this Day object if missing in Month\n      if (_this.scheduleArray[year].months[monthNum].days[dayNum] === undefined) {\n        _this.scheduleArray[year].months[monthNum].days[dayNum] = {\n          day: day,\n          events: []\n        };\n      }\n\n      // Push Event object to events array\n      _this.scheduleArray[year].months[monthNum].days[dayNum].events.push({\n        hour: hour,\n        title: scheduleEvent.title,\n        content: scheduleEvent.content\n      });\n    });\n  },\n\n  addEventsToDom: function() {\n    var _this = this;\n    var scheduleHTML = '';\n\n    // Make Years\n    _this.scheduleArray.forEach(function(year, yearIndex) {\n\n      // create content element\n      var yearContent = document.createElement('h3');\n      // fill with year\n      yearContent.innerText = year.year;\n\n      // add Year row to HTML\n      scheduleHTML += _this.makeEventsRow(\n        // parent element\n        _this.programacionContainer,\n        // row id\n        yearIndex,\n        // row content\n        yearContent\n      );\n\n      // Make Months\n      year.months.forEach(function(month, monthIndex) {\n\n        // create content element\n        var monthContent = document.createElement('h3');\n        // fill with month\n        monthContent.innerText = month.month;\n\n        // make Month row\n        _this.makeEventsRow(\n          document.getElementById(yearIndex),\n          yearIndex + '-' + monthIndex,\n          monthContent\n        );\n\n        // Make Days\n        month.days.forEach(function(day, dayIndex) {\n\n          // create content element\n          var dayContent = document.createElement('h3');\n          // fill with day\n          dayContent.innerText = day.day;\n\n          // make Day row\n          _this.makeEventsRow(\n            document.getElementById(yearIndex + '-' + monthIndex),\n            yearIndex + '-' + monthIndex + '-' + dayIndex,\n            dayContent\n          );\n\n          // Make Events\n          day.events.forEach(function(eventObj, eventIndex) {\n\n            // create content element\n            var eventContent = document.createElement('div');\n            // set element element class\n            eventContent.className = 'programacion-event';\n            // fill with event info\n            eventContent.innerHTML = '<div class=\"programacion-event-hour\">' + eventObj.hour + '</div><div class=\"programacion-event-info\"><h2>' + eventObj.title + '</h2>' + eventObj.content;\n\n            // make Event row\n            _this.makeEventsRow(\n              document.getElementById(yearIndex + '-' + monthIndex + '-' + dayIndex),\n              yearIndex + '-' + monthIndex + '-' + dayIndex + '-' + eventIndex,\n              eventContent\n            );\n\n          });\n\n        });\n\n      });\n\n    });\n  },\n\n  // Generate DOM for an events row and append it:\n  // <div id={id} class=\"programacion-row\">\n  //   {rowContent}\n  // </div>\n  makeEventsRow: function(container, id, rowContent) {\n    var _this = this;\n\n    // Create row element\n    var newRow = document.createElement('div');\n\n    // Set attributes\n    newRow.id = id;\n    newRow.className = 'programacion-row';\n    newRow.appendChild(rowContent);\n\n    // Append row to container\n    container.appendChild(newRow);\n  }\n};\n\nSite.Earth = {\n  canvasWidth: 128,\n  canvasHeight: 128,\n  textureUrl: WP.themeUrl + '/dist/img/earth_texture.jpg',\n  initialCameraZ: 1000,\n  init: function() {\n    var _this = this;\n\n    // Bind Animate function\n    _this.animate = _this.animate.bind(_this);\n\n    _this.container = document.getElementById('earth-container');\n\n    // -- Set Three stuff\n\n    // Set camera\n    _this.camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 2000 );\n    _this.camera.position.z = _this.initialCameraZ;\n\n    // Set Scene\n    _this.scene = new THREE.Scene();\n\n    // Set Group\n    _this.group = new THREE.Group();\n\n    // Add Group to the scene\n    _this.scene.add( _this.group );\n\n    // Load earth texture\n    _this.loadTexture();\n\n    // Create canvas element\n    _this.canvas = document.createElement( 'canvas' );\n\n    // Set Canvas size\n    _this.canvas.width = _this.canvasWidth;\n    _this.canvas.height = _this.canvasHeight;\n\n    // Render canvas\n    _this.renderCanvas();\n\n    // Animate\n    _this.animate();\n  },\n\n  renderCanvas: function() {\n    var _this = this;\n\n    var texture = new THREE.CanvasTexture( _this.canvas );\n    var geometry = new THREE.PlaneBufferGeometry( 300, 300, 3, 3 );\n    var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );\n    var mesh = new THREE.Mesh( geometry, material );\n\n    mesh.position.y = - 250;\n    mesh.rotation.x = - Math.PI / 2;\n    _this.group.add( mesh );\n\n    _this.renderer = new THREE.CanvasRenderer();\n    _this.renderer.setClearColor( 0xffffff );\n    _this.renderer.setPixelRatio( window.devicePixelRatio );\n    _this.renderer.setSize( document.body.clientWidth, window.innerHeight );\n    _this.container.appendChild( _this.renderer.domElement );\n  },\n\n  loadTexture: function() {\n    var _this = this;\n\n    var loader = new THREE.TextureLoader();\n\n    loader.load(_this.textureUrl, function (texture) {\n      var geometry = new THREE.SphereGeometry( 200, 20, 20 );\n      var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );\n      var mesh = new THREE.Mesh( geometry, material );\n      _this.group.add( mesh );\n    });\n  },\n\n  animate: function() {\n    var _this = this;\n\n    window.requestAnimationFrame(_this.animate);\n\n    _this.renderScene();\n  },\n\n  renderScene: function() {\n    var _this = this;\n\n    _this.camera.lookAt( _this.scene.position );\n    _this.group.rotation.y -= 0.005;\n    _this.renderer.render( _this.scene, _this.camera );\n  }\n};\n\nSite.StreamChecker = {\n  statusUrl: 'https://public.radio.co/stations/s0b5e9c02c/status',\n  statusCheckInterval: 5000,\n  streamData: null,\n  init: function() {\n    var _this = this;\n\n    _this.startChecker();\n  },\n\n  startChecker: function() {\n    var _this = this;\n\n\n    _this.checkStreamStatus();\n\n    // Start checker on an interval\n    setInterval(function() {\n      _this.checkStreamStatus();\n    }, _this.statusCheckInterval);\n  },\n\n  // Check the stream status thru ajax and change the player accordingly\n  checkStreamStatus: function() {\n    var _this = this;\n\n    // Make the ajax request\n    $.getJSON(_this.statusUrl, function(data) {\n\n      // Save data in a cache var, just in case\n      _this.streamData = data.status;\n\n      // Check if the stream is offline\n      if (data.status === 'offline') {\n\n        // Trigger the event\n        Site.triggerEvent('streamoffline', data);\n\n      } else if (data.status === 'online')  {  // else  (stream is online)\n\n        // Trigger the event\n        Site.triggerEvent('streamonline', data);\n      }\n    })\n    .fail( function() {\n      // Trigger the event\n      Site.triggerEvent('streamoffline');\n\n      console.log('Radio.co seems to be unresponsive');\n\n    });\n\n  },\n\n};\n\nSite.Player = {\n  neverPlayed: true,\n  fadeTime:  2000,\n  streamUrl: 'http://streaming.radio.co/s0b5e9c02c/listen',\n  init: function() {\n    var _this = this;\n\n    // Calculate the volume increment\n    _this.volumeIncrement = 1 / (_this.fadeTime / 50);\n\n    // Player DOM elements\n    _this.playerContainer =  document.getElementById('player-container');\n    _this.playerElement =  document.getElementById('player');\n    _this.playerSrc =  document.getElementById('player-src');\n    _this.playButton =  document.getElementById('play-button');\n    _this.pauseButton =  document.getElementById('pause-button');\n    _this.streamStatusText =  document.getElementById('stream-status');\n    _this.nowPlayingText =  document.getElementById('now-playing');\n\n    // Bind event handlers\n    _this.handleOnlineStream = _this.handleOnlineStream.bind(_this);\n    _this.handleCanplay = _this.handleCanplay.bind(_this);\n    _this.handleOfflineStream = _this.handleOfflineStream.bind(_this);\n    _this.animateTest = _this.animateTest.bind(_this); // TODO: Remove when globe is done\n\n    // Subscribe to stream events\n    document.addEventListener('streamonline', _this.handleOnlineStream);\n    document.addEventListener('streamoffline', _this.handleOfflineStream);\n\n    // Subscribe to clic on player controls\n    _this.playButton.addEventListener('click', _this.play.bind(_this));\n    _this.pauseButton.addEventListener('click', _this.pause.bind(_this));\n\n  },\n\n  /*\n   * Setup all web audio stuff.\n   */\n  setupAudioProcessing: function() {\n    var _this = this;\n\n    // Set Audio Context\n    _this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\n    // Create audio source from <audio>\n    _this.audioSource = _this.audioContext.createMediaElementSource(_this.playerElement);\n\n    // Create analyser node\n    _this.audioAnalyser = _this.audioContext.createAnalyser();\n\n    // Set analyser settings\n    _this.audioAnalyser.fftSize = 32;\n    _this.audioAnalyser.minDecibels = -90;\n    _this.audioAnalyser.maxDecibels = -10;\n    _this.audioAnalyser.smoothingTimeConstant = 1;\n\n    // Init the anaylser data array\n    _this.analyserData = new Uint8Array(_this.audioAnalyser.frequencyBinCount);\n\n    // Conect Source to Analyser\n    _this.audioSource.connect(_this.audioAnalyser);\n\n    // Conect Analyser to destination. connectin to destination triggers the audio\n    _this.audioAnalyser.connect(_this.audioContext.destination);\n\n  },\n\n  handleOnlineStream: function(event) {\n    var _this = this;\n\n    var data = event.detail;\n\n    // Add class `online` to the player container\n    _this.playerContainer.classList.add('online');\n\n    // Check if player src is empty\n    if (_this.playerSrc.src === '') {\n\n      // Add src\n      _this.playerSrc.src = _this.streamUrl;\n\n      // Disable player CORS restriction\n      _this.playerElement.crossOrigin = 'anonymous';\n\n      // Load src\n      _this.playerElement.load();\n\n    }\n\n    // Update marquee status\n    _this.streamStatusText.innerHTML = 'Ahora: ';\n\n    // Update Now playing\n    _this.nowPlayingText.innerHTML = data.current_track.title;\n\n    // We subscribe to the `canplay` event from the player\n    _this.playerElement.addEventListener('canplay', _this.handleCanplay);\n  },\n\n  handleCanplay: function(event) {\n    var _this = this;\n\n    // If the player has never started playing\n    if (_this.neverPlayed) {\n\n      // Play the player\n      _this.play();\n\n      // Setup Audio processing\n      _this.setupAudioProcessing();\n\n      // Trigger test animation, which actually is not really an animation but its just for testing\n      window.requestAnimationFrame(_this.animateTest); // TODO remove when globe is done\n    }\n\n  },\n\n  // TODO remove when globe is done\n  animateTest: function() {\n    var _this = this;\n\n    window.requestAnimationFrame(_this.animateTest);\n\n\n    // When the globe is done, from whatever code is animating it we will call `Site.Player.analyserData[2]` to\n    var level = parseInt(_this.getAnalyserValue() / 2);\n    var levelString = new Array(level + 1).join('#');\n\n    console.log(levelString);\n\n  },\n\n  // Returns analyser data\n  // TODO: Globe should call this function on every `render()`\n  // Site.Plater.getAnalyserValue();\n  getAnalyserValue: function() {\n    var _this = this;\n\n    // Pass anlyser data to _this.analyserData\n    _this.audioAnalyser.getByteTimeDomainData(_this.analyserData);\n\n    // from max 256\n    var returnAnalysisValue = 256 - _this.analyserData[0];\n\n    return returnAnalysisValue;\n\n  },\n\n  handleOfflineStream: function() {\n    var _this = this;\n\n    // Remove `online` class from the player container\n    _this.playerContainer.classList.remove('online');\n\n    // Update marquee status\n    _this.streamStatusText.innerHTML = 'Siguiente: ';\n\n    // Update the marquee text\n    _this.nowPlayingText.innerHTML = 'the upcoming show that has to be requested thru ajax';\n\n    // Pause the player\n    _this.pause();\n  },\n\n  play: function() {\n    var _this = this;\n\n    if (_this.playerElement.networkState !== 3) {\n\n      // Reset volume\n      _this.playerElement.volume = 0;\n\n      if( _this.playerElement.paused) {\n\n        // Play audio element\n        _this.playerElement.play();\n\n      }\n\n      // Add `playing` class to player container\n      _this.playerContainer.classList.add('playing');\n\n      _this.neverPlayed = false;\n\n      // Fade in the volume\n      var fadeInterval = setInterval( function() {\n        var newVolume = _this.playerElement.volume + _this.volumeIncrement;\n\n        if (newVolume > 1) {\n          newVolume = 1;\n        }\n\n        _this.playerElement.volume = newVolume;\n\n        if (_this.playerElement.volume >= 1) {\n          // Clear the interval\n          clearInterval(fadeInterval);\n\n        }\n      }, 50);\n    }\n  },\n\n  pause: function() {\n    var _this = this;\n\n    // Mute the player instead of pause to keep the stream in sync\n    // because pause doesn't exist in live radio\n    _this.playerElement.volume = 0;\n\n    // Remove `playing` class from the player container\n    _this.playerContainer.classList.remove('playing');\n  },\n};\n\nSite.init();\n"]}