{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","$","window","resize","onResize","document","ready","Player","Programacion","StreamChecker","fixWidows","each","string","html","replace","eventsPosts","JSON","parse","WP","programacionEvents","scheduleArray","programacionContainer","getElementById","fillEventsObject","addEventsToDom","callback","forEach","el","eventMoment","moment","unix","parseInt","timestamp","year","format","month","monthNum","day","dayNum","hour","months","undefined","days","events","push","title","content","scheduleHTML","yearIndex","yearContent","createElement","innerText","makeEventsRow","monthIndex","monthContent","dayIndex","dayContent","eventObj","eventIndex","eventContent","className","innerHTML","container","id","rowContent","newRow","appendChild","statusUrl","statusCheckInterval","streamData","startChecker","checkStreamStatus","setInterval","getJSON","data","status","triggerEvent","fail","console","log","eventName","detail","customEvent","CustomEvent","dispatchEvent","neverPlayed","fadeTime","streamUrl","playerContainer","playerElement","playerSrc","playButton","pauseButton","streamStatusText","nowPlayingText","handleOnlineStream","bind","handleCanplay","handleOfflineStream","addEventListener","play","pause","volumeIncrement","event","classList","add","src","paused","load","current_track","target","removeEventListener","type","remove","networkState","volume","fadeInterval","newVolume","clearInterval"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Site, Modernizr, Moment */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    $(window).resize(function(){\n      _this.onResize();\n    });\n\n    $(document).ready(function () {\n      Site.Player.init();\n      Site.Programacion.init();\n    });\n\n    Site.StreamChecker.init();\n  },\n\n  onResize: function() {\n    var _this = this;\n\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n};\n\nSite.Programacion = {\n  // parse JSON event posts object from Wordpress\n  eventsPosts: JSON.parse(WP.programacionEvents),\n  scheduleArray: [],\n  programacionContainer: document.getElementById('page-programacion'),\n\n  init: function() {\n    var _this = this;\n\n    // loop through Years -> Months -> Days -> Events\n    _this.fillEventsObject();\n\n    // add schedule to DOM\n    _this.addEventsToDom();\n  },\n\n  fillEventsObject: function(callback) {\n    var _this = this;\n\n    // forEach event\n    _this.eventsPosts.forEach(function(el) {\n      // generate moment from timestamp in user local timezone\n      var eventMoment = moment.unix(parseInt(el.timestamp));\n\n      var year = eventMoment.format('YYYY');\n      var month = eventMoment.format('MMMM');\n      var monthNum = eventMoment.format('M');\n      var day = eventMoment.format('dddd Do');\n      var dayNum = eventMoment.format('D');\n      var hour = eventMoment.format('H:mm');\n\n      // Create this Year object if missing in schedule array\n      if (!_this.scheduleArray[year]) {\n        _this.scheduleArray[year] = [];\n        _this.scheduleArray[year] = {\n          year: year,\n          months: []\n        }\n      }\n\n      // Create this Month object if missing in Year\n      if (_this.scheduleArray[year].months[monthNum] === undefined) {\n        _this.scheduleArray[year].months[monthNum] = {\n          month: month,\n          days: []\n        };\n      }\n\n      // Create this Day object if missing in Month\n      if (_this.scheduleArray[year].months[monthNum].days[dayNum] === undefined) {\n        _this.scheduleArray[year].months[monthNum].days[dayNum] = {\n          day: day,\n          events: []\n        };\n      }\n\n      // Push Event object to events array\n      _this.scheduleArray[year].months[monthNum].days[dayNum].events.push({\n        hour: hour,\n        title: el.title,\n        content: el.content\n      });\n    });\n  },\n\n  addEventsToDom: function() {\n    var _this = this;\n    var scheduleHTML = '';\n\n    // Make Years\n    _this.scheduleArray.forEach(function(year, yearIndex) {\n\n      // create content element\n      var yearContent = document.createElement('h3');\n      // fill with year\n      yearContent.innerText = year.year;\n\n      // add Year row to HTML\n      scheduleHTML += _this.makeEventsRow(\n        // parent element\n        _this.programacionContainer,\n        // row id\n        yearIndex,\n        // row content\n        yearContent\n      );\n\n      // Make Months\n      year.months.forEach(function(month, monthIndex) {\n\n        // create content element\n        var monthContent = document.createElement('h3');\n        // fill with month\n        monthContent.innerText = month.month;\n\n        // make Month row\n        _this.makeEventsRow(\n          document.getElementById(yearIndex),\n          yearIndex + '-' + monthIndex,\n          monthContent\n        );\n\n        // Make Days\n        month.days.forEach(function(day, dayIndex) {\n\n          // create content element\n          var dayContent = document.createElement('h3');\n          // fill with day\n          dayContent.innerText = day.day;\n\n          // make Day row\n          _this.makeEventsRow(\n            document.getElementById(yearIndex + '-' + monthIndex),\n            yearIndex + '-' + monthIndex + '-' + dayIndex,\n            dayContent\n          );\n\n          // Make Events\n          day.events.forEach(function(eventObj, eventIndex) {\n\n            // create content element\n            var eventContent = document.createElement('div');\n            // set element element class\n            eventContent.className = 'programacion-event';\n            // fill with event info\n            eventContent.innerHTML = '<div class=\"programacion-event-hour\">' + eventObj.hour + '</div><div class=\"programacion-event-info\"><h2>' + eventObj.title + '</h2>' + eventObj.content;\n\n            // make Event row\n            _this.makeEventsRow(\n              document.getElementById(yearIndex + '-' + monthIndex + '-' + dayIndex),\n              yearIndex + '-' + monthIndex + '-' + dayIndex + '-' + eventIndex,\n              eventContent\n            );\n\n          });\n\n        });\n\n      });\n\n    });\n  },\n\n  makeEventsRow: function(container, id, rowContent) {\n    var _this = this;\n\n    // create row element\n    var newRow = document.createElement('div');\n\n    newRow.id = id;\n    newRow.className = 'programacion-row';\n    newRow.appendChild(rowContent);\n\n    // append row to container\n    container.appendChild(newRow);\n  }\n}\n\nSite.StreamChecker = {\n  statusUrl: 'https://public.radio.co/stations/s0b5e9c02c/status',\n  statusCheckInterval: 5000,\n  streamData: null,\n  init: function() {\n    var _this = this;\n\n    _this.startChecker();\n  },\n\n  startChecker: function() {\n    var _this = this;\n\n\n    _this.checkStreamStatus();\n\n    // Start checker on an interval\n    setInterval(function() {\n      _this.checkStreamStatus();\n    }, _this.statusCheckInterval);\n  },\n\n  // Check the stream status thru ajax and change the player accordingly\n  checkStreamStatus: function() {\n    var _this = this;\n\n    // Make the ajax request\n    $.getJSON(_this.statusUrl, function(data) {\n\n      // Save data in a cache var, just in case\n      _this.streamData = data.status;\n\n      // Check if the stream is offline\n      if (data.status === 'offline') {\n\n        // Trigger the event\n        _this.triggerEvent('streamoffline', data);\n\n      } else if (data.status === 'online')  {  // else  (stream is online)\n\n        // Trigger the event\n        _this.triggerEvent('streamonline', data);\n      }\n    })\n    .fail( function() {\n      // Trigger the event\n      _this.triggerEvent('streamoffline');\n\n      console.log('Radio.co seems to be unresponsive');\n\n    });\n\n  },\n\n  triggerEvent: function(eventName, detail) {\n    var _this =  this;\n\n    console.log('event triggered: ', eventName);\n\n    var customEvent = new CustomEvent(eventName, {\n      detail: detail,\n    });\n\n    document.dispatchEvent(customEvent);\n  },\n\n};\n\nSite.Player = {\n  neverPlayed: true,\n  fadeTime:  2000,\n  streamUrl: 'http://streaming.radio.co/s0b5e9c02c/listen',\n  init: function() {\n    var _this = this;\n\n    // Player DOM elements\n    _this.playerContainer =  document.getElementById('player-container');\n    _this.playerElement =  document.getElementById('player');\n    _this.playerSrc =  document.getElementById('player-src');\n    _this.playButton =  document.getElementById('play-button');\n    _this.pauseButton =  document.getElementById('pause-button');\n    _this.streamStatusText =  document.getElementById('stream-status');\n    _this.nowPlayingText =  document.getElementById('now-playing');\n\n    // Bind event handlers\n    _this.handleOnlineStream = _this.handleOnlineStream.bind(_this);\n    _this.handleCanplay = _this.handleCanplay.bind(_this);\n    _this.handleOfflineStream = _this.handleOfflineStream.bind(_this);\n\n    // Subscribe to stream events\n    document.addEventListener('streamonline', _this.handleOnlineStream);\n    document.addEventListener('streamoffline', _this.handleOfflineStream);\n\n    // Subscribe to clic on player controls\n    _this.playButton.addEventListener('click', _this.play.bind(_this));\n    _this.pauseButton.addEventListener('click', _this.pause.bind(_this));\n\n\n    // Calculate the volume increment\n    _this.volumeIncrement = 1 / (_this.fadeTime / 50);\n\n  },\n\n  handleOnlineStream: function(event) {\n    var _this = this;\n\n    var data = event.detail;\n\n    // Add class `online` to the player container\n    _this.playerContainer.classList.add('online');\n\n    // Check if player src is empty\n    if (_this.playerSrc.src === '' || _this.playerElement.paused) {\n      // Add src\n      _this.playerSrc.src =  _this.streamUrl;\n\n      // Load src\n      _this.playerElement.load();\n    }\n\n    // Update marquee status\n    _this.streamStatusText.innerHTML = 'Ahora: ';\n\n    // Update Now playing\n    _this.nowPlayingText.innerHTML = data.current_track.title;\n\n    // If the player has never started playing\n    if (_this.neverPlayed) {\n      // We subscribe to the `canplay` event from the player\n      _this.playerElement.addEventListener('canplay', _this.handleCanplay);\n    }\n  },\n\n  handleCanplay: function(event) {\n    var _this = this;\n\n    // Play the audio element\n    _this.play();\n\n    // Remove listener cuz it's only needed once\n    event.target.removeEventListener(event.type, _this.handleCanplay);\n\n  },\n\n  handleOfflineStream: function() {\n    var _this = this;\n\n    // Remove `online` class from the player container\n    _this.playerContainer.classList.remove('online');\n\n    // Update marquee status\n    _this.streamStatusText.innerHTML = 'Siguiente: ';\n\n    // Update the marquee text\n    _this.nowPlayingText.innerHTML = 'the upcoming show that has to be requested thru ajax';\n\n    // Pause the audio element\n    _this.pause();\n  },\n\n  play: function() {\n    var _this = this;\n\n    if (_this.playerElement.networkState !== 3) {\n\n      // Reset volume\n      _this.playerElement.volume = 0;\n\n      // Play audio element\n      _this.playerElement.play();\n\n      // Add `playing` class to player container\n      _this.playerContainer.classList.add('playing');\n\n\n      _this.neverPlayed = false;\n\n      // Fade in the volume\n      var fadeInterval = setInterval( function() {\n        var newVolume = _this.playerElement.volume + _this.volumeIncrement;\n\n        if (newVolume > 1) {\n          newVolume = 1;\n        }\n\n        _this.playerElement.volume = newVolume;\n\n        if (_this.playerElement.volume >= 1) {\n          // Clear the interval\n          clearInterval(fadeInterval);\n\n        }\n      }, 50);\n    }\n  },\n\n  pause: function() {\n    var _this = this;\n\n    // Pause audio element\n    _this.playerElement.pause();\n\n    // Remove `playing` class from the player container\n    _this.playerContainer.classList.remove('playing');\n  },\n};\n\nSite.init();\n"]}