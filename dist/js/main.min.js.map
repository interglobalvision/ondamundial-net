{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","$","window","resize","onResize","document","ready","Player","Earth","StreamChecker","fixWidows","each","string","html","replace","canvasWidth","canvasHeight","textureUrl","WP","themeUrl","animate","bind","container","getElementById","camera","THREE","PerspectiveCamera","innerWidth","innerHeight","position","z","scene","Scene","group","Group","add","loadTexture","canvas","createElement","width","height","renderCanvas","texture","CanvasTexture","geometry","PlaneBufferGeometry","material","MeshBasicMaterial","map","overdraw","mesh","Mesh","y","rotation","x","Math","PI","renderer","CanvasRenderer","setClearColor","setPixelRatio","devicePixelRatio","setSize","appendChild","domElement","TextureLoader","load","SphereGeometry","requestAnimationFrame","renderScene","lookAt","render","statusUrl","statusCheckInterval","streamData","startChecker","checkStreamStatus","setInterval","getJSON","data","status","triggerEvent","fail","console","log","eventName","detail","customEvent","CustomEvent","dispatchEvent","neverPlayed","fadeTime","streamUrl","playerContainer","playerElement","playerSrc","playButton","pauseButton","streamStatusText","nowPlayingText","handleOnlineStream","handleCanplay","handleOfflineStream","addEventListener","play","pause","volumeIncrement","event","classList","src","paused","innerHTML","current_track","title","target","removeEventListener","type","remove","networkState","volume","fadeInterval","newVolume","clearInterval"],"mappings":"AAGAA,MACEC,gBAAiB,IACjBC,KAAM,WACJ,GAAIC,OAAQC,IAEZC,GAAEC,QAAQC,OAAO,WACfJ,MAAMK,aAGRH,EAAEI,UAAUC,MAAM,WAChBV,KAAKW,OAAOT,OACZF,KAAKY,MAAMV,SAGbF,KAAKa,cAAcX,QAGrBM,SAAU,aAKVM,UAAW,WAETT,EAAE,kBAAkBU,KAAK,WACvB,GAAIC,QAASX,EAAED,MAAMa,MACrBD,QAASA,OAAOE,QAAQ,YAAY,YACpCb,EAAED,MAAMa,KAAKD,YAKnBhB,KAAKY,OACHO,YAAa,IACbC,aAAc,IACdC,WAAYC,GAAGC,SAAW,8BAC1BrB,KAAM,WACJ,GAAIC,OAAQC,IAEZD,OAAMqB,QAAUrB,MAAMqB,QAAQC,KAAKtB,OAEnCA,MAAMuB,UAAYjB,SAASkB,eAAe,mBAE1CxB,MAAMyB,OAAS,GAAIC,OAAMC,kBAAmB,GAAIxB,OAAOyB,WAAazB,OAAO0B,YAAa,EAAG,KAC3F7B,MAAMyB,OAAOK,SAASC,EAAI,IAE1B/B,MAAMgC,MAAQ,GAAIN,OAAMO,MAExBjC,MAAMkC,MAAQ,GAAIR,OAAMS,MACxBnC,MAAMgC,MAAMI,IAAKpC,MAAMkC,OAGvBlC,MAAMqC,cAENrC,MAAMsC,OAAShC,SAASiC,cAAe,UACzCvC,MAAMsC,OAAOE,MAAQxC,MAAMgB,YAC3BhB,MAAMsC,OAAOG,OAASzC,MAAMiB,aAE1BjB,MAAM0C,eAEN1C,MAAMqB,WAGRqB,aAAc,WACZ,GAAI1C,OAAQC,KAER0C,QAAU,GAAIjB,OAAMkB,cAAe5C,MAAMsC,QAC3CO,SAAW,GAAInB,OAAMoB,oBAAqB,IAAK,IAAK,EAAG,GACvDC,SAAW,GAAIrB,OAAMsB,mBAAqBC,IAAKN,QAASO,SAAU,KAClEC,KAAO,GAAIzB,OAAM0B,KAAMP,SAAUE,SAErCI,MAAKrB,SAASuB,GAAM,IACpBF,KAAKG,SAASC,GAAMC,KAAKC,GAAK,EAC9BzD,MAAMkC,MAAME,IAAKe,MAEjBnD,MAAM0D,SAAW,GAAIhC,OAAMiC,eAC3B3D,MAAM0D,SAASE,cAAe,UAC9B5D,MAAM0D,SAASG,cAAe1D,OAAO2D,kBACrC9D,MAAM0D,SAASK,QAAS5D,OAAOyB,WAAYzB,OAAO0B,aAClD7B,MAAMuB,UAAUyC,YAAahE,MAAM0D,SAASO,aAG5C5B,YAAa,WACX,GAAIrC,OAAQC,MAEC,GAAIyB,OAAMwC,eAElBC,KAAKnE,MAAMkB,WAAY,SAAUyB,SACpC,GAAIE,UAAW,GAAInB,OAAM0C,eAAgB,IAAK,GAAI,IAC9CrB,SAAW,GAAIrB,OAAMsB,mBAAqBC,IAAKN,QAASO,SAAU,KAClEC,KAAO,GAAIzB,OAAM0B,KAAMP,SAAUE,SACrC/C,OAAMkC,MAAME,IAAKe,SAIrB9B,QAAS,WACP,GAAIrB,OAAQC,IAEdoE,uBAAsBrE,MAAMqB,SAC5BrB,MAAMsE,eAGPA,YAAa,WACV,GAAItE,OAAQC,IAEdD,OAAMyB,OAAO8C,OAAQvE,MAAMgC,MAAMF,UACjC9B,MAAMkC,MAAMoB,SAASD,GAAK,KAC1BrD,MAAM0D,SAASc,OAAQxE,MAAMgC,MAAOhC,MAAMyB,UAI5C5B,KAAKa,eACH+D,UAAW,qDACXC,oBAAqB,IACrBC,WAAY,KACZ5E,KAAM,WACQE,KAEN2E,gBAGRA,aAAc,WACZ,GAAI5E,OAAQC,IAGZD,OAAM6E,oBAGNC,YAAY,WACV9E,MAAM6E,qBACL7E,MAAM0E,sBAIXG,kBAAmB,WACjB,GAAI7E,OAAQC,IAGZC,GAAE6E,QAAQ/E,MAAMyE,UAAW,SAASO,MAGlChF,MAAM2E,WAAaK,KAAKC,OAGJ,YAAhBD,KAAKC,OAGPjF,MAAMkF,aAAa,gBAAiBF,MAEX,WAAhBA,KAAKC,QAGdjF,MAAMkF,aAAa,eAAgBF,QAGtCG,KAAM,WAELnF,MAAMkF,aAAa,iBAEnBE,QAAQC,IAAI,wCAMhBH,aAAc,SAASI,UAAWC,QAGhCH,QAAQC,IAAI,oBAAqBC,UAEjC,IAAIE,aAAc,GAAIC,aAAYH,WAChCC,OAAQA,QAGVjF,UAASoF,cAAcF,eAK3B3F,KAAKW,QACHmF,aAAa,EACbC,SAAW,IACXC,UAAW,8CACX9F,KAAM,WACJ,GAAIC,OAAQC,IAGZD,OAAM8F,gBAAmBxF,SAASkB,eAAe,oBACjDxB,MAAM+F,cAAiBzF,SAASkB,eAAe,UAC/CxB,MAAMgG,UAAa1F,SAASkB,eAAe,cAC3CxB,MAAMiG,WAAc3F,SAASkB,eAAe,eAC5CxB,MAAMkG,YAAe5F,SAASkB,eAAe,gBAC7CxB,MAAMmG,iBAAoB7F,SAASkB,eAAe,iBAClDxB,MAAMoG,eAAkB9F,SAASkB,eAAe,eAGhDxB,MAAMqG,mBAAqBrG,MAAMqG,mBAAmB/E,KAAKtB,OACzDA,MAAMsG,cAAgBtG,MAAMsG,cAAchF,KAAKtB,OAC/CA,MAAMuG,oBAAsBvG,MAAMuG,oBAAoBjF,KAAKtB,OAG3DM,SAASkG,iBAAiB,eAAgBxG,MAAMqG,oBAChD/F,SAASkG,iBAAiB,gBAAiBxG,MAAMuG,qBAGjDvG,MAAMiG,WAAWO,iBAAiB,QAASxG,MAAMyG,KAAKnF,KAAKtB,QAC3DA,MAAMkG,YAAYM,iBAAiB,QAASxG,MAAM0G,MAAMpF,KAAKtB,QAI7DA,MAAM2G,gBAAkB,GAAK3G,MAAM4F,SAAW,KAIhDS,mBAAoB,SAASO,OAC3B,GAAI5G,OAAQC,KAER+E,KAAO4B,MAAMrB,MAGjBvF,OAAM8F,gBAAgBe,UAAUzE,IAAI,WAGR,KAAxBpC,MAAMgG,UAAUc,KAAc9G,MAAM+F,cAAcgB,UAEpD/G,MAAMgG,UAAUc,IAAO9G,MAAM6F,UAG7B7F,MAAM+F,cAAc5B,QAItBnE,MAAMmG,iBAAiBa,UAAY,UAGnChH,MAAMoG,eAAeY,UAAYhC,KAAKiC,cAAcC,MAGhDlH,MAAM2F,aAER3F,MAAM+F,cAAcS,iBAAiB,UAAWxG,MAAMsG,gBAI1DA,cAAe,SAASM,OACtB,GAAI5G,OAAQC,IAGZD,OAAMyG,OAGNG,MAAMO,OAAOC,oBAAoBR,MAAMS,KAAMrH,MAAMsG,gBAIrDC,oBAAqB,WACnB,GAAIvG,OAAQC,IAGZD,OAAM8F,gBAAgBe,UAAUS,OAAO,UAGvCtH,MAAMmG,iBAAiBa,UAAY,cAGnChH,MAAMoG,eAAeY,UAAY,uDAGjChH,MAAM0G,SAGRD,KAAM,WACJ,GAAIzG,OAAQC,IAEZ,IAAyC,IAArCD,MAAM+F,cAAcwB,aAAoB,CAG1CvH,MAAM+F,cAAcyB,OAAS,EAG7BxH,MAAM+F,cAAcU,OAGpBzG,MAAM8F,gBAAgBe,UAAUzE,IAAI,WAGpCpC,MAAM2F,aAAc,CAGpB,IAAI8B,cAAe3C,YAAa,WAC9B,GAAI4C,WAAY1H,MAAM+F,cAAcyB,OAASxH,MAAM2G,eAE/Ce,WAAY,IACdA,UAAY,GAGd1H,MAAM+F,cAAcyB,OAASE,UAEzB1H,MAAM+F,cAAcyB,QAAU,GAEhCG,cAAcF,eAGf,MAIPf,MAAO,WACL,GAAI1G,OAAQC,IAGZD,OAAM+F,cAAcW,QAGpB1G,MAAM8F,gBAAgBe,UAAUS,OAAO,aAI3CzH,KAAKE","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Site, Modernizr */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    $(window).resize(function(){\n      _this.onResize();\n    });\n\n    $(document).ready(function () {\n      Site.Player.init();\n      Site.Earth.init();\n    });\n\n    Site.StreamChecker.init();\n  },\n\n  onResize: function() {\n    var _this = this;\n\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n};\n\nSite.Earth = {\n  canvasWidth: 128,\n  canvasHeight: 128,\n  textureUrl: WP.themeUrl + '/dist/img/earth_texture.jpg',\n  init: function() {\n    var _this = this;\n\n    _this.animate = _this.animate.bind(_this);\n\n    _this.container = document.getElementById('earth-container');\n\n    _this.camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 2000 );\n    _this.camera.position.z = 1000;\n\n    _this.scene = new THREE.Scene();\n\n    _this.group = new THREE.Group();\n    _this.scene.add( _this.group );\n\n    // load earth texture\n    _this.loadTexture();\n\n    _this.canvas = document.createElement( 'canvas' );\n\t\t_this.canvas.width = _this.canvasWidth;\n\t\t_this.canvas.height = _this.canvasHeight;\n\n    _this.renderCanvas();\n\n    _this.animate();\n  },\n\n  renderCanvas: function() {\n    var _this = this;\n\n    var texture = new THREE.CanvasTexture( _this.canvas );\n\t\tvar geometry = new THREE.PlaneBufferGeometry( 300, 300, 3, 3 );\n\t\tvar material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );\n\t\tvar mesh = new THREE.Mesh( geometry, material );\n\n\t\tmesh.position.y = - 250;\n\t\tmesh.rotation.x = - Math.PI / 2;\n\t\t_this.group.add( mesh );\n\n\t\t_this.renderer = new THREE.CanvasRenderer();\n\t\t_this.renderer.setClearColor( 0xffffff );\n\t\t_this.renderer.setPixelRatio( window.devicePixelRatio );\n\t\t_this.renderer.setSize( window.innerWidth, window.innerHeight );\n\t\t_this.container.appendChild( _this.renderer.domElement );\n  },\n\n  loadTexture: function() {\n    var _this = this;\n\n    var loader = new THREE.TextureLoader();\n\n\t\tloader.load(_this.textureUrl, function (texture) {\n      var geometry = new THREE.SphereGeometry( 200, 20, 20 );\n      var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );\n      var mesh = new THREE.Mesh( geometry, material );\n      _this.group.add( mesh );\n\t\t});\n  },\n\n  animate: function() {\n    var _this = this;\n\n\t\trequestAnimationFrame(_this.animate);\n\t\t_this.renderScene();\n  },\n\n\trenderScene: function() {\n    var _this = this;\n\n\t\t_this.camera.lookAt( _this.scene.position );\n\t\t_this.group.rotation.y -= 0.005;\n\t\t_this.renderer.render( _this.scene, _this.camera );\n\t}\n};\n\nSite.StreamChecker = {\n  statusUrl: 'https://public.radio.co/stations/s0b5e9c02c/status',\n  statusCheckInterval: 5000,\n  streamData: null,\n  init: function() {\n    var _this = this;\n\n    _this.startChecker();\n  },\n\n  startChecker: function() {\n    var _this = this;\n\n\n    _this.checkStreamStatus();\n\n    // Start checker on an interval\n    setInterval(function() {\n      _this.checkStreamStatus();\n    }, _this.statusCheckInterval);\n  },\n\n  // Check the stream status thru ajax and change the player accordingly\n  checkStreamStatus: function() {\n    var _this = this;\n\n    // Make the ajax request\n    $.getJSON(_this.statusUrl, function(data) {\n\n      // Save data in a cache var, just in case\n      _this.streamData = data.status;\n\n      // Check if the stream is offline\n      if (data.status === 'offline') {\n\n        // Trigger the event\n        _this.triggerEvent('streamoffline', data);\n\n      } else if (data.status === 'online')  {  // else  (stream is online)\n\n        // Trigger the event\n        _this.triggerEvent('streamonline', data);\n      }\n    })\n    .fail( function() {\n      // Trigger the event\n      _this.triggerEvent('streamoffline');\n\n      console.log('Radio.co seems to be unresponsive');\n\n    });\n\n  },\n\n  triggerEvent: function(eventName, detail) {\n    var _this =  this;\n\n    console.log('event triggered: ', eventName);\n\n    var customEvent = new CustomEvent(eventName, {\n      detail: detail,\n    });\n\n    document.dispatchEvent(customEvent);\n  },\n\n};\n\nSite.Player = {\n  neverPlayed: true,\n  fadeTime:  2000,\n  streamUrl: 'http://streaming.radio.co/s0b5e9c02c/listen',\n  init: function() {\n    var _this = this;\n\n    // Player DOM elements\n    _this.playerContainer =  document.getElementById('player-container');\n    _this.playerElement =  document.getElementById('player');\n    _this.playerSrc =  document.getElementById('player-src');\n    _this.playButton =  document.getElementById('play-button');\n    _this.pauseButton =  document.getElementById('pause-button');\n    _this.streamStatusText =  document.getElementById('stream-status');\n    _this.nowPlayingText =  document.getElementById('now-playing');\n\n    // Bind event handlers\n    _this.handleOnlineStream = _this.handleOnlineStream.bind(_this);\n    _this.handleCanplay = _this.handleCanplay.bind(_this);\n    _this.handleOfflineStream = _this.handleOfflineStream.bind(_this);\n\n    // Subscribe to stream events\n    document.addEventListener('streamonline', _this.handleOnlineStream);\n    document.addEventListener('streamoffline', _this.handleOfflineStream);\n\n    // Subscribe to clic on player controls\n    _this.playButton.addEventListener('click', _this.play.bind(_this));\n    _this.pauseButton.addEventListener('click', _this.pause.bind(_this));\n\n\n    // Calculate the volume increment\n    _this.volumeIncrement = 1 / (_this.fadeTime / 50);\n\n  },\n\n  handleOnlineStream: function(event) {\n    var _this = this;\n\n    var data = event.detail;\n\n    // Add class `online` to the player container\n    _this.playerContainer.classList.add('online');\n\n    // Check if player src is empty\n    if (_this.playerSrc.src === '' || _this.playerElement.paused) {\n      // Add src\n      _this.playerSrc.src =  _this.streamUrl;\n\n      // Load src\n      _this.playerElement.load();\n    }\n\n    // Update marquee status\n    _this.streamStatusText.innerHTML = 'Ahora: ';\n\n    // Update Now playing\n    _this.nowPlayingText.innerHTML = data.current_track.title;\n\n    // If the player has never started playing\n    if (_this.neverPlayed) {\n      // We subscribe to the `canplay` event from the player\n      _this.playerElement.addEventListener('canplay', _this.handleCanplay);\n    }\n  },\n\n  handleCanplay: function(event) {\n    var _this = this;\n\n    // Play the audio element\n    _this.play();\n\n    // Remove listener cuz it's only needed once\n    event.target.removeEventListener(event.type, _this.handleCanplay);\n\n  },\n\n  handleOfflineStream: function() {\n    var _this = this;\n\n    // Remove `online` class from the player container\n    _this.playerContainer.classList.remove('online');\n\n    // Update marquee status\n    _this.streamStatusText.innerHTML = 'Siguiente: ';\n\n    // Update the marquee text\n    _this.nowPlayingText.innerHTML = 'the upcoming show that has to be requested thru ajax';\n\n    // Pause the audio element\n    _this.pause();\n  },\n\n  play: function() {\n    var _this = this;\n\n    if (_this.playerElement.networkState !== 3) {\n\n      // Reset volume\n      _this.playerElement.volume = 0;\n\n      // Play audio element\n      _this.playerElement.play();\n\n      // Add `playing` class to player container\n      _this.playerContainer.classList.add('playing');\n\n\n      _this.neverPlayed = false;\n\n      // Fade in the volume\n      var fadeInterval = setInterval( function() {\n        var newVolume = _this.playerElement.volume + _this.volumeIncrement;\n\n        if (newVolume > 1) {\n          newVolume = 1;\n        }\n\n        _this.playerElement.volume = newVolume;\n\n        if (_this.playerElement.volume >= 1) {\n          // Clear the interval\n          clearInterval(fadeInterval);\n\n        }\n      }, 50);\n    }\n  },\n\n  pause: function() {\n    var _this = this;\n\n    // Pause audio element\n    _this.playerElement.pause();\n\n    // Remove `playing` class from the player container\n    _this.playerContainer.classList.remove('playing');\n  },\n};\n\nSite.init();\n"]}