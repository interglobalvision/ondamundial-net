Site={mobileThreshold:601,init:function(){var _this=this;$(window).resize(function(){_this.onResize()}),$(document).ready(function(){Site.Earth.init(),Site.Overlay.init(),Site.Player.init(),Site.Programacion.init()}),Site.StreamChecker.init(),Site.EventChecker.init()},onResize:function(){Site.Earth.onResize(),Site.EventChecker.onResize(),Site.Overlay.onResize()},fixWidows:function(){$(".js-fix-widows").each(function(){var string=$(this).html();string=string.replace(/ ([^ ]*)$/,"&nbsp;$1"),$(this).html(string)})},triggerEvent:function(eventName,detail){var customEvent=new CustomEvent(eventName,{detail:detail});document.dispatchEvent(customEvent)}},Site.Overlay={activeNavItem:null,desktopWidth:1024,init:function(){var _this=this;_this.pageOverlay=document.getElementsByClassName("page-overlay"),_this.header=document.getElementById("header"),_this.mobileToggle=document.getElementById("mobile-overlay-toggle"),_this.mobileMenu=document.getElementById("mobile-menu"),_this.pageOpen=document.getElementsByClassName("js-page-open"),_this.desktopPageClose=document.getElementsByClassName("desktop-page-close"),_this.bindClicks()},bindClicks:function(){var _this=this;_this.mobileToggle.addEventListener("click",_this.toggleMobile.bind(_this));for(var i=0;i<_this.pageOpen.length;i++)_this.pageOpen[i].addEventListener("click",_this.openPage.bind(_this));for(var i=0;i<_this.desktopPageClose.length;i++)_this.desktopPageClose[i].addEventListener("click",_this.closePage.bind(_this))},toggleOverlay:function(){document.body.classList.contains("overlay-active")?document.body.classList.remove("overlay-active"):document.body.classList.add("overlay-active")},toggleMobile:function(){var _this=this;null!==document.querySelector(".page-active")?(_this.closePage(),_this.toggleOverlay()):_this.mobileMenu.classList.contains("active")?_this.mobileMenu.classList.remove("active"):_this.mobileMenu.classList.add("active"),_this.toggleOverlay()},openPage:function(event){var _this=this,pageName=event.target.getAttribute("data-page");_this.activePage=document.getElementById("page-"+pageName),_this.activePage.classList.add("page-active"),_this.activeDesktopNavItem=document.getElementById("desktop-nav-"+pageName),_this.activeDesktopNavItem.classList.add("active"),_this.mobileMenu.classList.contains("active")?_this.mobileMenu.classList.remove("active"):_this.toggleOverlay()},closePage:function(){var _this=this;_this.activeDesktopNavItem.classList.remove("active"),_this.activePage.classList.remove("page-active"),_this.toggleOverlay()},onResize:function(){var _this=this;document.body.clientWidth>=_this.desktopWidth&&_this.mobileMenu.classList.contains("active")&&(_this.mobileMenu.classList.remove("active"),_this.toggleOverlay())}},Site.Programacion={eventsPosts:JSON.parse(WP.programacionEvents),scheduleArray:[],init:function(){var _this=this;_this.programacionContainer=document.getElementById("programacion-container"),_this.eventsPosts.length&&(_this.fillEventsObject(),_this.addEventsToDom())},fillEventsObject:function(){var _this=this;_this.eventsPosts.forEach(function(scheduleEvent){var eventMoment=moment.unix(parseInt(scheduleEvent.timestamp)),year=eventMoment.format("YYYY"),month=eventMoment.format("MMMM"),monthNum=eventMoment.format("M"),day=eventMoment.format("dddd Do"),dayNum=eventMoment.format("D"),hour=eventMoment.format("H:mm");void 0===_this.scheduleArray[year]&&(_this.scheduleArray[year]={year:year,months:[]}),void 0===_this.scheduleArray[year].months[monthNum]&&(_this.scheduleArray[year].months[monthNum]={month:month,days:[]}),void 0===_this.scheduleArray[year].months[monthNum].days[dayNum]&&(_this.scheduleArray[year].months[monthNum].days[dayNum]={day:day,events:[]}),_this.scheduleArray[year].months[monthNum].days[dayNum].events.push({hour:hour,title:scheduleEvent.title,content:scheduleEvent.content})})},addEventsToDom:function(){var _this=this,scheduleHTML="";_this.scheduleArray.forEach(function(year,yearIndex){_this.programacionContainer.innerHTML="";var yearContent=document.createElement("h3");yearContent.innerText=year.year,yearContent.classList.add("font-averta"),scheduleHTML+=_this.makeEventsRow(_this.programacionContainer,yearIndex,yearContent),year.months.forEach(function(month,monthIndex){var monthContent=document.createElement("h3");monthContent.innerText=month.month,monthContent.classList.add("font-averta"),_this.makeEventsRow(document.getElementById(yearIndex),yearIndex+"-"+monthIndex,monthContent),month.days.forEach(function(day,dayIndex){var dayContent=document.createElement("h3");dayContent.innerText=day.day,dayContent.classList.add("font-averta"),_this.makeEventsRow(document.getElementById(yearIndex+"-"+monthIndex),yearIndex+"-"+monthIndex+"-"+dayIndex,dayContent),day.events.forEach(function(eventObj,eventIndex){var eventContent=document.createElement("div");eventContent.className="programacion-event",eventContent.innerHTML='<div class="programacion-event-hour font-averta">'+eventObj.hour+'</div><div class="programacion-event-info"><h2 class="font-aileron-semibold">'+eventObj.title+"</h2>"+eventObj.content,_this.makeEventsRow(document.getElementById(yearIndex+"-"+monthIndex+"-"+dayIndex),yearIndex+"-"+monthIndex+"-"+dayIndex+"-"+eventIndex,eventContent)})})})})},makeEventsRow:function(container,id,rowContent){var newRow=document.createElement("div");newRow.id=id,newRow.className="programacion-row",newRow.appendChild(rowContent),container.appendChild(newRow)}},Site.Earth={canvasWidth:128,canvasHeight:128,textureUrl:WP.themeUrl+"/dist/img/earth_texture.jpg",initialCameraZ:1e3,init:function(){var _this=this;_this.isSafari()?_this.initFlatEarth():_this.initThreeEarth()},isSafari:function(){return!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.body.style.webkitFilter&&!window.chrome},initFlatEarth:function(){var _this=this;_this.flatEarth=document.getElementById("earth-flat"),_this.flatEarth.classList.remove("u-hidden"),_this.animateFlatEarth=_this.animateFlatEarth.bind(_this),_this.animateFlatEarth(),_this.flatEarth.addEventListener("click",_this.handleOnClick.bind(_this))},animateFlatEarth:function(){var _this=this;window.requestAnimationFrame(_this.animateFlatEarth);var audioValue=Site.Player.getAnalyserValue();audioValue*=3,audioValue=1+audioValue,_this.flatEarth.style.transform="scale("+audioValue+")"},initThreeEarth:function(){var _this=this;_this.animate=_this.animate.bind(_this),_this.container=document.getElementById("earth-container"),_this.camera=new THREE.PerspectiveCamera(60,document.body.clientWidth/window.innerHeight,1,2e3),_this.camera.position.z=_this.initialCameraZ,_this.scene=new THREE.Scene,_this.group=new THREE.Group,_this.scene.add(_this.group),_this.loadTexture(),_this.canvas=document.createElement("canvas"),_this.canvas.width=_this.canvasWidth,_this.canvas.height=_this.canvasHeight,_this.renderCanvas(),_this.animate(),_this.container.addEventListener("click",_this.handleOnClick.bind(_this))},handleOnClick:function(){Site.Player.togglePlay()},renderCanvas:function(){var _this=this,texture=new THREE.CanvasTexture(_this.canvas),geometry=new THREE.PlaneBufferGeometry(300,300,3,3),material=new THREE.MeshBasicMaterial({map:texture,overdraw:.5}),mesh=new THREE.Mesh(geometry,material);mesh.position.y=-250,mesh.rotation.x=-Math.PI/2,_this.group.add(mesh),_this.renderer=new THREE.CanvasRenderer({alpha:!0}),_this.renderer.setClearColor(0,0),_this.renderer.setPixelRatio(window.devicePixelRatio),_this.renderer.setSize(document.body.clientWidth,window.innerHeight),_this.container.appendChild(_this.renderer.domElement)},loadTexture:function(){var _this=this;(new THREE.TextureLoader).load(_this.textureUrl,function(texture){var geometry=new THREE.SphereGeometry(200,20,20),material=new THREE.MeshBasicMaterial({map:texture,overdraw:.5}),mesh=new THREE.Mesh(geometry,material);_this.group.add(mesh)})},animate:function(){var _this=this;window.requestAnimationFrame(_this.animate),_this.renderScene()},renderScene:function(){var _this=this;_this.camera.lookAt(_this.scene.position),_this.group.rotation.y+=.005;var audioValue=Site.Player.getAnalyserValue();audioValue=1-audioValue,_this.camera.position.z=audioValue*_this.initialCameraZ,_this.renderer.render(_this.scene,_this.camera)},onResize:function(){var _this=this;void 0!==_this.camera&&(_this.camera.aspect=document.body.clientWidth/window.innerHeight,_this.camera.updateProjectionMatrix(),_this.renderer.setSize(document.body.clientWidth,window.innerHeight))}},Site.StreamChecker={statusUrl:"https://public.radio.co/stations/s0b5e9c02c/status",statusCheckInterval:5e3,streamData:null,init:function(){this.startChecker()},startChecker:function(){var _this=this;_this.checkStreamStatus(),setInterval(function(){_this.checkStreamStatus()},_this.statusCheckInterval)},checkStreamStatus:function(){var _this=this;$.getJSON(_this.statusUrl,function(data){_this.streamData=data.status,"offline"===data.status?Site.triggerEvent("streamoffline",data):"online"===data.status&&Site.triggerEvent("streamonline",data)}).fail(function(){Site.triggerEvent("streamoffline"),console.log("Radio.co seems to be unresponsive")})}},Site.Player={neverPlayed:!0,fadeTime:100,fftSize:32,freqBand:1,streamUrl:"http://streaming.radio.co/s0b5e9c02c/listen",streamData:{},isPlaying:!1,init:function(){var _this=this;_this.volumeIncrement=1/(_this.fadeTime/50),_this.playerContainer=document.getElementById("player-container"),_this.playerElement=document.getElementById("player"),_this.playerSrc=document.getElementById("player-src"),_this.playButton=document.getElementById("play-button"),_this.pauseButton=document.getElementById("pause-button"),_this.streamStatusText=document.getElementById("stream-status"),_this.nowPlayingText=document.getElementById("now-playing"),_this.marqueeHolder=document.getElementById("now-playing-marquee-holder"),_this.handleOnlineStream=_this.handleOnlineStream.bind(_this),_this.handleCanplay=_this.handleCanplay.bind(_this),_this.handleOfflineStream=_this.handleOfflineStream.bind(_this),document.addEventListener("streamonline",_this.handleOnlineStream),document.addEventListener("streamoffline",_this.handleOfflineStream),_this.playButton.addEventListener("click",_this.play.bind(_this)),_this.pauseButton.addEventListener("click",_this.pause.bind(_this))},setupAudioProcessing:function(){var _this=this;_this.audioContext=new(window.AudioContext||window.webkitAudioContext),_this.audioSource=_this.audioContext.createMediaElementSource(_this.playerElement),_this.audioAnalyser=_this.audioContext.createAnalyser(),_this.audioAnalyser.fftSize=_this.fftSize,_this.audioAnalyser.smoothingTimeConstant=1,_this.analyserData=new Uint8Array(_this.audioAnalyser.frequencyBinCount),_this.audioSource.connect(_this.audioAnalyser),_this.audioAnalyser.connect(_this.audioContext.destination)},handleOnlineStream:function(event){var _this=this;void 0!==_this.streamData.current_track&&event.detail.current_track.title===_this.streamData.current_track.title||(_this.streamData=event.detail,_this.playerContainer.classList.add("online"),""===_this.playerSrc.src&&(_this.playerSrc.src=_this.streamUrl,_this.playerElement.crossOrigin="anonymous",_this.playerElement.load()),_this.streamStatusText.innerHTML="Ahora: ",_this.playerElement.addEventListener("canplay",_this.handleCanplay)),_this.buildMarqueeContent(_this.streamData.current_track.title)},buildMarqueeContent:function(marqueeText){var _this=this,marqueeWidth=_this.marqueeHolder.offsetWidth;void 0!==Site.EventChecker.eventData.title&&(marqueeText=Site.EventChecker.eventData.title+": "+marqueeText),Site.EventChecker.eventData.marqueeText&&(marqueeText+=" "+Site.EventChecker.eventData.marqueeText);var marqueeTextElem='<span class="now-playing-text">'+marqueeText+"</span>";_this.nowPlayingText.innerHTML=marqueeTextElem;for(var nowPlayingWidth=_this.nowPlayingText.offsetWidth,intoWindow=Math.round(marqueeWidth/nowPlayingWidth),marqueeContent='<span class="now-playing-text-holder">',i=0;i<4*intoWindow;i++)marqueeContent+=marqueeTextElem;_this.nowPlayingText.innerHTML=marqueeContent+"</span>"},handleCanplay:function(){var _this=this;_this.neverPlayed&&(_this.play(),_this.setupAudioProcessing())},getAnalyserValue:function(){var _this=this;if(void 0===_this.audioContext)return 0;_this.audioAnalyser.getByteTimeDomainData(_this.analyserData);var returnAnalysisValue=_this.analyserData[_this.freqBand];return returnAnalysisValue<128?returnAnalysisValue=128-returnAnalysisValue:returnAnalysisValue-=128,returnAnalysisValue/=128},handleOfflineStream:function(){var _this=this;_this.playerContainer.classList.remove("online"),_this.streamStatusText.innerHTML="Sigue: ",_this.nowPlayingText.innerHTML="the upcoming show that has to be requested thru ajax",_this.pause()},play:function(){var _this=this;if(3!==_this.playerElement.networkState){_this.playerElement.volume=0,_this.playerElement.paused&&_this.playerElement.play(),_this.playerContainer.classList.add("playing"),_this.isPlaying=!0,_this.neverPlayed=!1;var fadeInterval=setInterval(function(){var newVolume=_this.playerElement.volume+_this.volumeIncrement;newVolume>1&&(newVolume=1),_this.playerElement.volume=newVolume,_this.playerElement.volume>=1&&clearInterval(fadeInterval)},50)}},pause:function(){var _this=this;_this.playerElement.volume=0,_this.playerContainer.classList.remove("playing"),_this.isPlaying=!1},togglePlay:function(){var _this=this;_this.isPlaying?_this.pause():_this.play()}},Site.EventChecker={eventUrl:WP.siteUrl+"/wp-json/igv/current-event",eventCheckInterval:5e3,eventData:{},init:function(){var _this=this;_this.setViewportLargestDimension(),_this.setViewportLargestDimension=_this.setViewportLargestDimension.bind(_this),_this.startChecker()},setViewportLargestDimension:function(){var _this=this;window.innerHeight>document.body.clientWidth?_this.viewporLargestDimension={dimension:"height",size:window.innerHeight}:_this.viewporLargestDimension={dimension:"width",size:document.body.clientWidth}},startChecker:function(){var _this=this;_this.checkEvent(),setInterval(function(){_this.checkEvent()},_this.eventCheckInterval)},checkEvent:function(){var _this=this;$.getJSON(_this.eventUrl,function(data){data?(_this.eventData=data,_this.eventData.title!==data.title&&(data.featuredThumbnails?_this.setBackground(data.featuredThumbnails):void 0!==typeof WP.fallbackImage?_this.setBackground(WP.fallbackImage):_this.clearBackground())):_this.clearEvent()})},setBackground:function(images){for(var _this=this,viewportLargestDimension=_this.viewporLargestDimension.size,background=images[images.length-1].url,i=0;i<images.length;i++){if(images[i][_this.viewporLargestDimension.dimension]>viewportLargestDimension){background=images[i].url;break}}document.body.style.backgroundImage="url("+background+")"},clearEvent:function(){var _this=this;_this.eventData=!1,_this.clearBackground()},clearBackground:function(){document.body.style.backgroundImage=""},onResize:function(){var _this=this;_this.setViewportLargestDimension(),_this.eventData&&_this.setBackground(_this.eventData.featuredThumbnails)}},Site.init();
//# sourceMappingURL=main.min.js.map
